name: Push

on: 
  push:

jobs:
  lint-build:
    runs-on: ubuntu-latest
    name: "âœ… Lint and build"
    steps:
    - name: ğŸ“‚ Checkout
      uses: actions/checkout@v4
    - name: ğŸ§¶ Set up Node.js
      uses: ./.github/actions/init-node
    - name: ğŸš¨ Linting
      uses: borales/actions-yarn@v5
      with:
        cmd: lint
    - name: ğŸ—ï¸ Build
      uses: borales/actions-yarn@v5
      with:
        cmd: build
      env:
        NEXT_PUBLIC_ENV: "ci"
  unit-tests:
    runs-on: ubuntu-latest
    name: "ğŸ”¬ Unit tests"
    steps:
    - name: ğŸ“‚ Checkout
      uses: actions/checkout@v4
    - name: ğŸ§¶ Set up Node.js
      uses: ./.github/actions/init-node
    - name: ğŸ”¬ Unit tests with jest
      uses: borales/actions-yarn@v5
      with:
        cmd: test:unit:ci
      env:
        NEXT_PUBLIC_ENV: "unit"
    - name: ğŸ“Š Coverage
      uses: MishaKav/jest-coverage-comment@main
      with: 
        github-token: ${{ secrets.GITHUB_TOKEN }}
        coverage-summary-path: ./coverage/coverage-summary.json
        summary-title: "ğŸ“Š Summary Coverage unit tests"
  component-tests:
    runs-on: ubuntu-latest
    name: "ğŸï¸ Component tests"
    steps:
    - name: ğŸ“‚ Checkout
      uses: actions/checkout@v4
    - name: ğŸ§¶ Set up Node.js
      uses: ./.github/actions/init-node
    - name: ğŸï¸ Component tests with Cypress
      uses: borales/actions-yarn@v5
      with:
        cmd: test:component:ci
      env:
        NEXT_PUBLIC_ENV: "component"
  e2e-tests:
    needs: 
      - lint-build
    runs-on: ubuntu-latest
    name: "ğŸ¤– E2E tests"
    steps:
    - name: ğŸ“‚ Checkout
      uses: actions/checkout@v4
    - name: ğŸ§¶ Set up Node.js
      uses: ./.github/actions/init-node
    - name: ğŸï¸ E2E tests with Cypress
      uses: borales/actions-yarn@v5
      with:
        cmd: test:e2e:ci
      env:
        NEXT_PUBLIC_ENV: "e2e"
      